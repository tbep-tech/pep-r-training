<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>do.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PEP R Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="rbasics.html">R Basics</a>
</li>
<li>
  <a href="wq.html">Water quality</a>
</li>
<li>
  <a href="pathogens.html">Pathogens</a>
</li>
<li>
  <a href="do.html">Dissolved oxygen</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Data_and_Resources.html">
    <span class="fas fa-list"></span>
     
    Data and resources
  </a>
</li>
<li>
  <a href="https://github.com/tbep-tech/pep-r-training">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<div id="dissolved-oxygen" class="section level1">
<h1>Dissolved oxygen</h1>
<p>Get the lesson R script: <a href="do.R">do.R</a></p>
<div id="lesson-outline" class="section level2">
<h2>Lesson Outline</h2>
<ul>
<li><a href="#goals-and-motivation">Goals and motivation</a></li>
<li><a href="#importing-do-data">Importing DO data</a></li>
<li><a href="#summarizing-do-data">Summarizing DO data</a></li>
<li><a href="#plotting-do-data">Plotting DO data</a></li>
</ul>
</div>
<div id="goals-and-motivation" class="section level2">
<h2>Goals and motivation</h2>
<p>This module will provide you with background on how to use the peptools R package to import, summarize, and plot dissolved oxygen data. You should be able to answer these questions at the end of this session:</p>
<ul>
<li>How can I use the peptools package to import dissolved oxygen data?</li>
<li>How does the peptools package summarize dissolved oxygen data for reporting?</li>
<li>What functions are available for summarizing dissolved oxygen data?</li>
<li>What functions are available for plotting dissolved oxygen data?</li>
</ul>
</div>
<div id="importing-do-data" class="section level2">
<h2>Importing DO data</h2>
<p>Two continuous USGS monitoring stations collect DO data at locations in the Peconic Estuary: USGS stations 01304562 in the Peconic River and 01304200 in Orient Harbor. Data at these stations can be downloaded using the <code>read_pepdo()</code> function.</p>
<pre class="r"><code>exdat &lt;- read_pepdo(site = c(&#39;01304562&#39;, &#39;01304200&#39;), nms = c(&#39;Peconic R.&#39;, &#39;Orient Harbor&#39;), startDate = &#39;2020-06-01&#39;, endDate = &#39;2020-06-30&#39;)</code></pre>
<p>The <code>dodat</code> data object included with the package provides DO data from 2013 to 2020 at the two sites. This takes several minutes to download using the <code>read_pepdo()</code> function, so it is included with the package for ease of use.</p>
<pre class="r"><code>head(dodat)</code></pre>
<pre><code>##            site            DateTime do_mgl
## 1 Orient Harbor 2013-01-01 00:00:00   11.2
## 2 Orient Harbor 2013-01-01 00:06:00   11.2
## 3 Orient Harbor 2013-01-01 00:12:00   11.2
## 4 Orient Harbor 2013-01-01 00:18:00   11.2
## 5 Orient Harbor 2013-01-01 00:24:00   11.2
## 6 Orient Harbor 2013-01-01 00:30:00   11.2</code></pre>
</div>
<div id="summarizing-do-data" class="section level2">
<h2>Summarizing DO data</h2>
<p>Dissolved oxygen data typically show daily and seasonal variation. Summaries of condition should account for variation at both temporal scales. Further, the impact of low dissolved oxygen concentrations on biota can vary depending on both magnitude and duration of hypoxia/anoxia. As such, condition assessment could also consider how often concentrations fall below a thresholds and for how long. The assessments below speak to each of these needs.</p>
<p>First, the data can be summarized from the continuous (~6 minute observations) to daily averages using the <code>anlz_dodlpep()</code> function. A user-specified threshold can be supplied to the <code>thr</code> argument to summarize the data relative to a value of interest, the default value being the acute threshold of 3 mg/L (an alternative may be the chronic threshold of 4.8 mg/L, <a href="Ambient%20aquatic%20life%20water%20quality%20criteria%20for%20dissolved%20oxygen%20(saltwater):%20Cape%20Cod%20to%20Cape%20Hatteras">USEPA 2000</a>).</p>
<pre class="r"><code># 3 mg/l is acute, 4.8 mg/l is chronic
dlysum &lt;- anlz_dodlypep(dodat, thr = 3)
dlysum</code></pre>
<pre><code>## # A tibble: 5,338 x 7
##    site          Date          yr    mo do_mgl below below_cumsum
##    &lt;fct&gt;         &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;
##  1 Peconic River 2013-01-01  2013     1   11.0     0            0
##  2 Peconic River 2013-01-02  2013     1   11.3     0            0
##  3 Peconic River 2013-01-03  2013     1   11.6     0            0
##  4 Peconic River 2013-01-04  2013     1   11.6     0            0
##  5 Peconic River 2013-01-05  2013     1   11.7     0            0
##  6 Peconic River 2013-01-06  2013     1   11.8     0            0
##  7 Peconic River 2013-01-07  2013     1   12.0     0            0
##  8 Peconic River 2013-01-08  2013     1   12.1     0            0
##  9 Peconic River 2013-01-09  2013     1   12.0     0            0
## 10 Peconic River 2013-01-10  2013     1   11.7     0            0
## # ... with 5,328 more rows</code></pre>
<p>The last three columns show the daily summarized data. The <code>do_mgl</code> column shows the average DO concentration for each day, the <code>below</code> column shows a 1 (yes) or 0 (no) if the concentration was below the threshold value at any point during a day, and the <code>below_cumsum</code> column shows a cumulative tally of the number of days in each month at which dissolved oxygen fell below the threshold at any point during a day.</p>
<p>The data can also be summarized by month using the <code>anlz_domopep()</code> function. Summarizing by month distills the information into a simple format for plotting. Internally, the <code>anlz_domopep()</code> function uses the <code>anlz_dodlypep()</code> function to first summarize results by day, which are then summarized by month.</p>
<pre class="r"><code>mosum &lt;- anlz_domopep(dodat, thr = 3)
mosum</code></pre>
<pre><code>## # A tibble: 189 x 6
##    site             yr mo    do_mgl below_ave below_maxrun
##  * &lt;fct&gt;         &lt;dbl&gt; &lt;ord&gt;  &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Peconic River  2013 Jan    11.6      0                0
##  2 Peconic River  2013 Feb    11.9      0                0
##  3 Peconic River  2013 Mar    11.7      0                0
##  4 Peconic River  2013 Apr     9.55     0                0
##  5 Peconic River  2013 May     7.90     0                0
##  6 Peconic River  2013 Jun     5.73     0.3              5
##  7 Peconic River  2013 Jul     3.12     1               27
##  8 Peconic River  2013 Aug     3.13     1               24
##  9 Peconic River  2013 Sep     4.81     0.655            6
## 10 Peconic River  2013 Oct     6.03     0.348            7
## # ... with 179 more rows</code></pre>
<p>The last three columns show the monthly summarized data, where <code>do_mgl</code> is the average of all daily DO averages across the month, <code>below_ave</code> is the proportion of days in a month when concentrations in a given day fell below the threshold (1 would mean all days had an instance of DO below the threshold, 0 would mean none), and <code>below_maxrun()</code> is the maximum number of sequential days in a month when concentrations in a given day fell below the threshold (30 or 31, depending on month, would indicate all days in a month had an instance of DO below the threshold).</p>
<p>The <code>below_ave</code> and <code>below_maxrun</code> columns summarize the DO data differently depending on how hypoxia/anoxia conditions can be described relative to potential impacts on biological resources. The <code>below_ave</code> column summarizes undersaturation relative to only the number of times hypoxia conditions occurred, whereas the <code>below_maxrun</code> column summarizes undersaturation relative to both the number of instances and duration of hypoxia. In other words, biota may be stressed differently depending on the number of times hypoxia occurs vs how long it may persist. The two measures may indicate similar information, but not always depending on characteristics of the DO time series.</p>
</div>
<div id="plotting-do-data" class="section level2">
<h2>Plotting DO data</h2>
<p>The summarized monthly data can be plotted with the <code>show_domatrix()</code> function. In this example, the default plot shows the proportion of days in a month when concentrations in a given day fell below a threshold of 3 mg/L.</p>
<pre class="r"><code>show_domatrix(dodat, thr = 3, show = &#39;below_ave&#39;)</code></pre>
<p><img src="do_files/figure-html/unnamed-chunk-5-1.png" width="768" /></p>
<p>The maximum number of sequential days in a month when concentrations in a given day fell below the threshold can also be plotted by changing the <code>show</code> argument.</p>
<pre class="r"><code>show_domatrix(dodat, thr = 3, show = &#39;below_maxrun&#39;)</code></pre>
<p><img src="do_files/figure-html/unnamed-chunk-6-1.png" width="768" /></p>
<p>The threshold can also be changed. For example, the chronic threshold of 4.8 mg/L shows conditions relative to a more conservative threshold.</p>
<pre class="r"><code>show_domatrix(dodat, thr = 4.8, show = &#39;below_ave&#39;)</code></pre>
<p><img src="do_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
<p>Plotting the results provides insights into hypoxia patterns at the site depending on how under-saturated conditions were summarized. Additional considerations may include:</p>
<ol style="list-style-type: decimal">
<li>Relevance of a threshold to biological indicator</li>
<li>Spatial extent of the indicators</li>
<li>Breakpoints for management decisions</li>
</ol>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
