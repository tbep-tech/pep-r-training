<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>pathogens.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 52px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h2 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h3 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h4 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h5 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h6 {
  padding-top: 57px;
  margin-top: -57px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PEP R Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="rbasics.html">R Basics</a>
</li>
<li>
  <a href="wq.html">Water quality</a>
</li>
<li>
  <a href="pathogens.html">Pathogens</a>
</li>
<li>
  <a href="do.html">Dissolved oxygen</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Data_and_Resources.html">
    <span class="fas fa-list"></span>
     
    Data and resources
  </a>
</li>
<li>
  <a href="https://github.com/tbep-tech/pep-r-training">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="pathogens" class="section level1">
<h1>Pathogens</h1>
<p>Get the lesson R script: <a href="pathogens.R">pathogens.R</a></p>
<p>Get the lesson data: <a href="data/data.zip">download zip</a></p>
<div id="lesson-outline" class="section level2">
<h2>Lesson Outline</h2>
<ul>
<li><a href="#goals-and-motivation">Goals and motivation</a></li>
<li><a href="#background">Background</a></li>
<li><a href="#data-import-and-processing">Data import and processing</a></li>
<li><a href="#plotting-results">Plotting results</a></li>
</ul>
</div>
<div id="goals-and-motivation" class="section level2">
<h2>Goals and motivation</h2>
<p>This module will provide you with background on how to use the peptools R package to import, summarize, and plot beach pathogen data. You should be able to answer these questions at the end of this session:</p>
<ul>
<li>How can I use the peptools package to import pathogen data?</li>
<li>How does the peptools package summarize pathogen data for reporting?</li>
<li>What functions are available for summarizing pathogen data?</li>
<li>What functions are available for plotting pathogen data?</li>
</ul>
</div>
<div id="background" class="section level2">
<h2>Background</h2>
<p>Regular monitoring of swimming beach pathogens is conducted by Suffolk County Department of Health Services (SCDHS). As noted on the Suffolk County website (<a href="https://www.suffolkcountyny.gov/Departments/Health-Services/Environmental-Quality/Ecology/Beach-Monitoring-Program" class="uri">https://www.suffolkcountyny.gov/Departments/Health-Services/Environmental-Quality/Ecology/Beach-Monitoring-Program</a>), water quality at swimming beaches can be adversely affected by episodic sources such as stormwater runoff, wastewater discharges from boats or land-based septic systems, and fecal material from pets and wildlife. To provide information on the potential presence of pathogens public in swimming areas that may be impacted by such contamination, the Suffolk County Department of Health Services (SCDHS) conducts a comprehensive bathing beach water quality monitoring program from May through September each year. Sampling is performed by SCDHS staff, with analyses conducted by the Department’s accredited Public and Environmental Health Laboratory (PEHL). Data are available <a href="https://gisportal.suffolkcountyny.gov/gis/home/item.html?id=025cb4dadb57413980dbd7e760b94da8">here</a>.</p>
<p>Information from this monitoring program can be summarized in “stoplight” form, to communicate the relative risk of exposure to pathogens at bathing beaches in the Peconic Estuary. Functions in the peptools package can be used to import the pathogen data provided by SCHDS and PEHL, analyze relative exceedances of pathogen criterion, and plot the results in an easily interpretable format. This training module describes use of these functions.</p>
</div>
<div id="data-import-and-processing" class="section level2">
<h2>Data import and processing</h2>
<p>The pathogen data can be imported using the <code>read_pepent()</code> function. A compressed folder that includes the data can be downloaded from <a href="https://gisportal.suffolkcountyny.gov/gis/home/item.html?id=025cb4dadb57413980dbd7e760b94da8">here</a>. After the data are downloaded and extracted, the Excel file with the raw data is named “QryEnteros 2010 - 2019.xlsx”, or something similar depending on when the data were downloaded. The location of this file on your computer is passed to the import function. Below, a local file renamed as “enterodata.xlsx” that contains the pathogen data is imported.</p>
<pre class="r"><code>entdat &lt;- read_pepent(&#39;data/enterodata.xlsx&#39;)
head(entdat)</code></pre>
<pre><code>## [90m# A tibble: 6 x 5[39m
##   Name                  FieldNum Date                value status
##   [3m[90m&lt;chr&gt;[39m[23m                 [3m[90m&lt;chr&gt;[39m[23m    [3m[90m&lt;dttm&gt;[39m[23m              [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m 
## [90m1[39m Alberts Landing Beach EH7      2010-06-29 [90m09:47:00[39m     4 [90m&quot;[39m&lt;[90m&quot;[39m   
## [90m2[39m Alberts Landing Beach EH7      2010-07-27 [90m09:49:00[39m     4 [90m&quot;[39m&lt;[90m&quot;[39m   
## [90m3[39m Alberts Landing Beach EH7      2010-08-13 [90m09:18:00[39m    28 [90m&quot;[39m[90m&quot;[39m    
## [90m4[39m Alberts Landing Beach EH7      2011-06-22 [90m10:21:00[39m     4 [90m&quot;[39m&lt;[90m&quot;[39m   
## [90m5[39m Alberts Landing Beach EH7      2011-07-20 [90m10:57:00[39m     4 [90m&quot;[39m&lt;[90m&quot;[39m   
## [90m6[39m Alberts Landing Beach EH7      2011-08-17 [90m11:14:00[39m     4 [90m&quot;[39m&lt;[90m&quot;[39m</code></pre>
<p>The raw data includes concentrations of <em>Enterococcus</em> bacteria as cfu/100 mL for swimming beaches in Suffolk County. The imported data returned by <code>read_pepent()</code> has a similar format as the raw data with slight modifications for readability in R. The fields include beach name (<code>Name</code>), field number (<code>FieldNum</code>), collection date and time (<code>Date</code> as Eastern Standard Time), bacteria concentration (<code>value</code>), and <code>status</code> showing if the observation was above or below detection (indicated as <code>&gt;</code> or <code>&lt;</code>).</p>
<p>The function <code>anlz_entpep()</code> summarizes the imported data at each beach to quantify instances when bacterial concentrations were at risk of impacting human health. For Suffolk County, all bathing beaches are ranked by relative risk of exposure to harmful bacteria. Factors considered in the ranking include pollution threats (outfalls, discharges, runoff, marinas, etc.), beach location, historical monitoring data, and beach use. Most beaches in the Peconic Estuary are Tier 2, with at least 1-2 samples for bacterial concentrations collected weekly. For the peptools package, the <em>Enterococcus</em> data were used to count the number of instances at each beach when concentrations were above 104 cfu/ml. Although this does not mean a beach was closed, relative exceedances provide a coarse measure of potential risk of exposure to harmful pathogens.</p>
<p>The <code>anlz_entpep()</code> function estimates this exposure risk by counting the number of instances in a year when concentrations at a beach exceeded the threshold for each 24 hour period in the dataset. The results show <code>samples</code> for number of days sampled each year, number of <code>exceedances</code> for the samples, and <code>perexceedances</code> as the proportion of samples with exceedances. Only the 28 relevant beaches for the Peconic Estuary are returned.</p>
<pre class="r"><code>anlz_entpep(entdat)</code></pre>
<pre><code>## [90m# A tibble: 308 x 5[39m
##    Name                     yr samples exceedances proexceedances
##  [90m*[39m [3m[90m&lt;chr&gt;[39m[23m                 [3m[90m&lt;dbl&gt;[39m[23m   [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m Alberts Landing Beach  [4m2[24m010       3           0          0    
## [90m 2[39m Alberts Landing Beach  [4m2[24m011       3           0          0    
## [90m 3[39m Alberts Landing Beach  [4m2[24m012       4           0          0    
## [90m 4[39m Alberts Landing Beach  [4m2[24m013       3           0          0    
## [90m 5[39m Alberts Landing Beach  [4m2[24m014       4           0          0    
## [90m 6[39m Alberts Landing Beach  [4m2[24m015       3           0          0    
## [90m 7[39m Alberts Landing Beach  [4m2[24m016       5           0          0    
## [90m 8[39m Alberts Landing Beach  [4m2[24m017       3           0          0    
## [90m 9[39m Alberts Landing Beach  [4m2[24m018       6           1          0.167
## [90m10[39m Alberts Landing Beach  [4m2[24m019       3           0          0    
## [90m# … with 298 more rows[39m</code></pre>
<p>The <code>anlz_entpep()</code> function includes an optional arguments for the threshold (<code>thr</code>). The default values are 104 cfu/100 mL, which can easily be changed. Here we use a threshold of 50 cfu/100 mL.</p>
<pre class="r"><code>anlz_entpep(entdat, thr = 50)</code></pre>
<pre><code>## [90m# A tibble: 308 x 5[39m
##    Name                     yr samples exceedances proexceedances
##  [90m*[39m [3m[90m&lt;chr&gt;[39m[23m                 [3m[90m&lt;dbl&gt;[39m[23m   [3m[90m&lt;int&gt;[39m[23m       [3m[90m&lt;int&gt;[39m[23m          [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m Alberts Landing Beach  [4m2[24m010       3           0          0    
## [90m 2[39m Alberts Landing Beach  [4m2[24m011       3           0          0    
## [90m 3[39m Alberts Landing Beach  [4m2[24m012       4           0          0    
## [90m 4[39m Alberts Landing Beach  [4m2[24m013       3           0          0    
## [90m 5[39m Alberts Landing Beach  [4m2[24m014       4           0          0    
## [90m 6[39m Alberts Landing Beach  [4m2[24m015       3           0          0    
## [90m 7[39m Alberts Landing Beach  [4m2[24m016       5           0          0    
## [90m 8[39m Alberts Landing Beach  [4m2[24m017       3           0          0    
## [90m 9[39m Alberts Landing Beach  [4m2[24m018       6           1          0.167
## [90m10[39m Alberts Landing Beach  [4m2[24m019       3           0          0    
## [90m# … with 298 more rows[39m</code></pre>
</div>
<div id="plotting-results" class="section level2">
<h2>Plotting results</h2>
<p>A summary graphic can be plotted using the <code>show_matrixpep()</code> function. This creates an annual reporting matrix for the relative risk of pathogen exposure at 28 selected beaches in the Peconic Estuary. Tracking the number of exceedances of bacterial concentrations provides a framework for identifying locations that may need management actions to remediate potential public health issues.</p>
<pre class="r"><code>show_entmatrix(entdat)</code></pre>
<div class="figure">
<img src="pathogens_files/figure-html/unnamed-chunk-4-1.png" alt="Frequencies of exceedances of *Enterococcus* concentrations at Peconic Estuary bathing beaches for the years 2010 through 2020.  Values are proportion of samples exceeding." width="672" />
<p class="caption">
Frequencies of exceedances of <em>Enterococcus</em> concentrations at Peconic Estuary bathing beaches for the years 2010 through 2020. Values are proportion of samples exceeding.
</p>
</div>
<p>The graphic can also show the number of exceedances as counts by changing the <code>show</code> argument.</p>
<pre class="r"><code>show_entmatrix(entdat, show = &#39;exceedances&#39;)</code></pre>
<div class="figure">
<img src="pathogens_files/figure-html/unnamed-chunk-5-1.png" alt="Frequencies of exceedances of *Enterococcus* concentrations at Peconic Estuary bathing beaches for the years 2010 through 2020.  Values are number of samples exceeding." width="672" />
<p class="caption">
Frequencies of exceedances of <em>Enterococcus</em> concentrations at Peconic Estuary bathing beaches for the years 2010 through 2020. Values are number of samples exceeding.
</p>
</div>
<p>The <code>anlz_entpep()</code> function is used internally in <code>show_entmatrix()</code>, such that the optional argument for the threshold (<code>thr</code>) also applies in the plotting function. Appropriate thresholds should be identified. Potential alternatives can be viewed by using a different value for the <code>thr</code> argument.</p>
<pre class="r"><code>show_entmatrix(entdat, thr = 35)</code></pre>
<div class="figure">
<img src="pathogens_files/figure-html/unnamed-chunk-6-1.png" alt="Frequencies of exceedances of *Enterococcus* concentrations at Peconic Estuary bathing beaches for the years 2010 through 2020.  A different option is used for the threshold argument." width="672" />
<p class="caption">
Frequencies of exceedances of <em>Enterococcus</em> concentrations at Peconic Estuary bathing beaches for the years 2010 through 2020. A different option is used for the threshold argument.
</p>
</div>
<p>The matrix is also a <code>ggplot</code> object and its layout can be changed using <code>ggplot</code> elements. Note the use of <code>txtsz = NULL</code> to remove the text labels.</p>
<pre class="r"><code>library(tidyverse)

show_entmatrix(entdat, txtsz = NULL) +
  scale_x_discrete(expand = c(0,0), breaks = c(2000:2020)) + 
  coord_flip() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 7))</code></pre>
<p><img src="pathogens_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
